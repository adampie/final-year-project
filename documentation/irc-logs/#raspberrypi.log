#raspbianpi @ irc.freenode.net

Oct 24 17:56:33 <adampie>	Can someone explain what this does? -> debconf-set-selections <<SELEOF
Oct 24 17:56:33 <adampie>	`cat ${i}-debconf`
Oct 24 17:56:33 <adampie>	SELEOF

Oct 24 17:57:27 <shiftplusone>	adampie: pi-gen stuff ey?
Oct 24 17:57:35 <shiftplusone>	It's pre-seeding answers to debconf questions

Oct 24 17:57:54 <adampie>	Yep. working on something for my final year project at uni

Oct 24 17:58:17 <shiftplusone>	adampie: are you the one porting it to use... some other thing I forget the name of?

Oct 24 17:58:28 <adampie>	Ansible yeah

Oct 24 17:58:28 <shiftplusone>	ansible comes to mind
Oct 24 17:58:57 <shiftplusone>	Ah okay, I had an email about it from your supervisor... cool. Let me know if you have any questions. I am the one responsible for the mess that is pi-gen.
Oct 24 18:00:10 <shiftplusone>	adampie: are you confused by the syntax itself or by what debconf-set-selections does?

Oct 24 18:06:17 <adampie>	shiftplusone Oh ha cool, yeah my supervisor mentioned that he emailed in. I'm just trying to understand what the whole thing does atm (I've made my repos public incase anyone was interested -> https://github.com/adampie) But yeah I tried a build last night and got a weird HUNK failure to do with lightdm when getting the timings per build stage.

Oct 24 18:07:02 <shiftplusone>	I think I know what failed

Oct 24 18:07:37 <mgottschlag>	adampie: what is the goal of your project? :)
Oct 24 18:08:14 <mgottschlag>	nvm, found the proposal :)

Oct 24 18:08:31 <shiftplusone>	adampie: raspberrypi-ui-mods has a change to set libgksu-gconf-defaults, but that fails if libgksu is not installed

Oct 24 18:09:49 <adampie>	mgottsclag Ah cool, overall to learn ansible. If it speeds up build phases then it's great. If not then it's not the end of the world

Oct 24 18:10:09 <shiftplusone>	It will be faster if you don't copy each stage like I am doing.
Oct 24 18:10:26 <shiftplusone>	if you use qcow and branch each stage instead, it will be much faster
Oct 24 18:10:46 <shiftplusone>	otherwise, most of the bottleneck is installing the packages, which won't be any faster
Oct 24 18:11:36 <shiftplusone>	You can take a look at spindle to see how it's done with qcow images and how to convert the final qcow image into a raw image.
Oct 24 18:12:15 <shiftplusone>	I didn't like fiddling with qcow images, so I dropped that. Might be useful to add it back as an option one day.

Oct 24 18:13:09 <adampie>	I was actually thinking depending on what final build you want it would get all the packages at once and do other config stuff simultaneously as it's a feature of ansible. Just need to fully understand what's happening and what can happen at the same time.

Oct 24 18:14:57 <shiftplusone>	Not sure you'll trim down the time much that way. The concurrency issues will be fun to work out too.
Oct 24 18:19:31 <shiftplusone>	adampie: I have a fix for the issue you saw, but am going home soon and would like to test it a little more thoroughly first.
Oct 24 18:20:03 <shiftplusone>	Have learned my lesson about pushing things out and going home before I am 100% sure it's okay. >.>

Oct 24 18:24:44 <adampie>	Ahh cool, I will playaround with it more then. Ha dw, I was just confused as it randomly just stopped working for me last night. :)

Oct 24 18:25:27 <shiftplusone>	adampie: if you want to work around the issue for now, make sure libgksu2-0 is installed before raspberrypi-ui-mods.

Oct 24 18:26:50 <adampie>	Ok thanks

Oct 24 18:36:41 <shiftplusone>	adampie: oh, just remembered what the good the good targets to run in parallel are. zipping and tarring thing. Also, an export stage can run at the same time as the next build stage. That will speed things up a lot.
Oct 24 18:36:52 <shiftplusone>	-1 'the good' <.<

Oct 24 18:38:47 <adampie>	Ooo thanks for the pointers, will have to talk to my supervisor to alter my schedule a bit.

Oct 24 18:45:18 <ali1234>	shiftplusone: do you know what hardware raspbian is built on?
Oct 24 18:47:09 <ali1234>	shiftplusone: also, how big is a pi-gen stage 1 image?

Oct 24 18:48:50 <shiftplusone>	ali1234: Intel(R) Core(TM) i7-4800MQ CPU @ 2.70GHz, 16GB RAM.
Oct 24 18:49:06 <shiftplusone>	don't know the stage 1 size off the top of my head

Oct 24 18:49:10 <ali1234>	is it built in qemu then?

Oct 24 18:49:21 <shiftplusone>	qemu-user chroot

Oct 24 18:49:34 <ali1234>	fun...
Oct 24 18:49:42 <ali1234>	pi-gen looks real similar to debirf

Oct 24 18:49:43 <shiftplusone>	building it on a chromebook isn't any faster

Oct 24 18:50:18 <ali1234>	my problem at the moment is i have to do a lot of building on th epi

Oct 24 18:50:28 <shiftplusone>	It's also similar to live-boot.... you kind of end up with similar things when there are common design goals.

Oct 24 18:50:33 <ali1234>	which takes forever, mainly because SD cards are slow
Oct 24 18:51:10 <ali1234>	so what does pi-gen do about this? also qemu?

Oct 24 18:51:15 <shiftplusone>	look into getting a samsung chromebook

Oct 24 18:51:33 <ali1234>	i have a samsung chromebox somewhere but it's x86

Oct 24 18:52:12 <shiftplusone>	yeah, I meant the arm one. I use it to build things like chromium, libreoffice and whatever else takes a week on the pi and then crashes while linking because there is not enough ram

Oct 24 18:52:28 <ali1234>	i've managed to get everything i need cross compiling

Oct 24 18:52:36 <shiftplusone>	ah okay

Oct 24 18:52:37 <ali1234>	the slow point is now building the image
Oct 24 18:52:51 <ali1234>	running debootstrap takes about 10 minutes
Oct 24 18:53:13 <ali1234>	specifically it sits on "I: Resolving dependencies of required packages..."

Oct 24 18:53:26 <shiftplusone>	well, you just cache the debootstrap and re-use it.

Oct 24 18:53:44 <ali1234>	hmm... yeah i should do that

Oct 24 18:54:05 <shiftplusone>	live-boot does that, along with all the packages

Oct 24 18:54:26 <ali1234>	i'm using apt-cacher-ng

Oct 24 18:54:34 <shiftplusone>	I use apt-cacher-ng and local mirrors for the packages, but that's not really for speed but to be able to build if raspbian.org goes down.

Oct 24 18:54:51 <ali1234>	it's a big speed increase for me cos my internet sucks
Oct 24 18:55:08 <ali1234>	also saves huge amounts of bandwidth

Oct 24 18:55:39 <shiftplusone>	the pi office has good internet plumbing, as you'd expect. >.>

Oct 24 18:55:59 <ali1234>	so my whole image build takes 25 minutes... how does that shape up to pi-gen and live-image?

Oct 24 18:56:16 <adampie>	Around 74 mins for me

Oct 24 18:56:25 <shiftplusone>	comparing apples and oranges here though

Oct 24 18:56:31 <ali1234>	my image is probably a lot simpler than yours of course

Oct 24 18:56:34 <shiftplusone>	yeah

Oct 24 18:56:44 <ali1234>	it's literally a debootstrap and about 10 packages
Oct 24 18:57:25 <ali1234>	however, about 10 minutes of that is the debootstrap and about another 10 minutes is gzipping the final image, which is about 250MB uncompressed

Oct 24 18:58:09 <shiftplusone>	pigz is a good alternative to gzip

Oct 24 18:58:10 <ali1234>	the trouble is that debirf uses fakeroot which doesn't cooperate with qemu and various other cross-arch techniques

Oct 24 18:58:15 <shiftplusone>	archive in parallel

Oct 24 18:58:20 <ali1234>	i've actually switched to lzop

Oct 24 18:58:27 <shiftplusone>	ah

Oct 24 18:58:34 <DWKnight>	anything that can do multithreaded compression will probably help
Oct 24 18:58:49 <DWKnight>	although you hit a ceiling on what your hardware is able to handle

Oct 24 18:58:52 <ali1234>	it's faster than pigz even though it,s single threaded, and it uncompresses over twice as fast too

Oct 24 18:58:57 <adampie>	How does apt-get compare to apt-fast?

Oct 24 18:59:14 <ali1234>	it's 10% larger but it decreased my boottime from ~35 seconds to ~15 seconds

Oct 24 18:59:21 <shiftplusone>	apt-fast only downloads in parallel, doesn't it?

Oct 24 19:00:08 <shiftplusone>	would be nice for apt to install in parallel
Oct 24 19:00:29 <shiftplusone>	and have an option not to md5sum, double handle and sync so much.

Oct 24 19:00:30 <ali1234>	i'd guess that's highly unlikely to ever happen
Oct 24 19:01:12 <ali1234>	oh btw thanks for fixing the kernel dependency thing

Oct 24 19:01:25 <shiftplusone>	no worries, sorry it took so long

Oct 24 19:01:39 <ali1234>	i won't need to build a fake package with equivs any more, should save a few seconds on the build and a couple kb in the image :)

Oct 24 19:01:45 <shiftplusone>	wanted to be sure I understood the consequences before doing something that could leave people without a kernel
Oct 24 19:02:28 <shiftplusone>	luckily apt auto-remove only suggests stuff for removal if it's not in recommends of an already installed package.

Oct 24 19:03:07 <ali1234>	well, that seems logical

Oct 24 19:05:28 <ali1234>	i need to figure out how to make debootstrap use busybox... standard wget introduces a dependency on libicu and pulls in like 50MB of stuff i dont want